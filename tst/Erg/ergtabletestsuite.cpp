#include "ergtabletestsuite.h"

#include <QCoreApplication>

#include "Tools/testsettings.h"


ErgTableTestSuite::ErgTableTestSuite()
{

}



void ErgTableTestSuite::test_wattageEstimation(const QList<ergDataPoint> &inputs, const QList<ergDataPoint>& expectedOutputs) {

    TestSettings testSettings("Roberto Viola", "QDomyos-Zwift Testing");
    testSettings.activate(); // previous settings should be restored automatically when this object goes out of scope via its destructor

    // "just in case", clear the DataPoints settings so that the ergtable is blank
    testSettings.qsettings.remove("ergDataPoints");

    ergTable erg;

    // set up the erg table
    for(const ergDataPoint& dataPoint : inputs)
        erg.collectData(dataPoint.cadence, dataPoint.wattage, dataPoint.resistance, true);

    // tst the results
    for(const ergDataPoint& dataPoint : expectedOutputs)
    {
        auto wattage = erg.estimateWattage(dataPoint.cadence, dataPoint.resistance);
        EXPECT_NEAR(dataPoint.wattage, wattage, 1) << "Expected estimated wattage from C:" << dataPoint.cadence << " R:"<<dataPoint.resistance << " to be " << dataPoint.wattage;
    }
}

void ErgTableTestSuite::test_dynamicErgTable() {

    QList<ergDataPoint> inputs, expected;

    // real table from https://github.com/cagnulein/qdomyos-zwift/discussions/2138#discussioncomment-8664852
    inputs.append(ergDataPoint(57, 86, 5));
    inputs.append(ergDataPoint(58, 89, 5));
    inputs.append(ergDataPoint(59, 92, 5));
    inputs.append(ergDataPoint(60, 95, 5));
    inputs.append(ergDataPoint(62, 100, 5));
    inputs.append(ergDataPoint(61, 97, 5));
    inputs.append(ergDataPoint(56, 84, 5));
    inputs.append(ergDataPoint(55, 81, 5));
    inputs.append(ergDataPoint(53, 76, 5));
    inputs.append(ergDataPoint(52, 73, 5));
    inputs.append(ergDataPoint(54, 78, 5));
    inputs.append(ergDataPoint(67, 115, 5));
    inputs.append(ergDataPoint(70, 124, 5));
    inputs.append(ergDataPoint(71, 126, 5));
    inputs.append(ergDataPoint(68, 118, 5));
    inputs.append(ergDataPoint(66, 112, 5));
    inputs.append(ergDataPoint(76, 139, 5));
    inputs.append(ergDataPoint(82, 155, 5));
    inputs.append(ergDataPoint(81, 152, 5));
    inputs.append(ergDataPoint(80, 150, 5));
    inputs.append(ergDataPoint(83, 158, 5));
    inputs.append(ergDataPoint(87, 168, 5));
    inputs.append(ergDataPoint(91, 180, 5));
    inputs.append(ergDataPoint(93, 186, 5));
    inputs.append(ergDataPoint(97, 200, 5));
    inputs.append(ergDataPoint(99, 206, 5));
    inputs.append(ergDataPoint(101, 213, 5));
    inputs.append(ergDataPoint(104, 223, 5));
    inputs.append(ergDataPoint(102, 216, 5));
    inputs.append(ergDataPoint(98, 203, 5));
    inputs.append(ergDataPoint(86, 166, 5));
    inputs.append(ergDataPoint(77, 158, 6));
    inputs.append(ergDataPoint(72, 141, 6));
    inputs.append(ergDataPoint(66, 121, 6));
    inputs.append(ergDataPoint(60, 102, 6));
    inputs.append(ergDataPoint(57, 93, 6));
    inputs.append(ergDataPoint(64, 115, 6));
    inputs.append(ergDataPoint(65, 118, 6));
    inputs.append(ergDataPoint(68, 128, 6));
    inputs.append(ergDataPoint(71, 138, 6));
    inputs.append(ergDataPoint(78, 161, 6));
    inputs.append(ergDataPoint(80, 168, 6));
    inputs.append(ergDataPoint(86, 182, 6));
    inputs.append(ergDataPoint(96, 214, 6));
    inputs.append(ergDataPoint(101, 233, 6));
    inputs.append(ergDataPoint(110, 268, 6));
    inputs.append(ergDataPoint(111, 271, 6));
    inputs.append(ergDataPoint(109, 264, 6));
    inputs.append(ergDataPoint(87, 184, 6));
    inputs.append(ergDataPoint(78, 171, 7));
    inputs.append(ergDataPoint(67, 133, 7));
    inputs.append(ergDataPoint(62, 116, 7));
    inputs.append(ergDataPoint(57, 101, 7));
    inputs.append(ergDataPoint(56, 98, 7));
    inputs.append(ergDataPoint(70, 144, 7));
    inputs.append(ergDataPoint(72, 150, 7));
    inputs.append(ergDataPoint(77, 167, 7));
    inputs.append(ergDataPoint(80, 178, 7));
    inputs.append(ergDataPoint(85, 192, 7));
    inputs.append(ergDataPoint(88, 200, 7));
    inputs.append(ergDataPoint(91, 210, 7));
    inputs.append(ergDataPoint(94, 222, 7));
    inputs.append(ergDataPoint(96, 230, 7));
    inputs.append(ergDataPoint(101, 251, 7));
    inputs.append(ergDataPoint(112, 296, 7));
    inputs.append(ergDataPoint(115, 308, 7));
    inputs.append(ergDataPoint(121, 333, 7));
    inputs.append(ergDataPoint(120, 329, 7));
    inputs.append(ergDataPoint(113, 300, 7));
    inputs.append(ergDataPoint(100, 247, 7));
    inputs.append(ergDataPoint(92, 214, 7));
    inputs.append(ergDataPoint(83, 186, 7));
    inputs.append(ergDataPoint(66, 130, 7));
    inputs.append(ergDataPoint(59, 107, 7));
    inputs.append(ergDataPoint(59, 107, 8));
    inputs.append(ergDataPoint(53, 96, 8));
    inputs.append(ergDataPoint(48, 81, 8));
    inputs.append(ergDataPoint(47, 78, 8));
    inputs.append(ergDataPoint(49, 84, 8));
    inputs.append(ergDataPoint(52, 93, 8));
    inputs.append(ergDataPoint(54, 99, 8));
    inputs.append(ergDataPoint(61, 121, 8));
    inputs.append(ergDataPoint(68, 149, 8));
    inputs.append(ergDataPoint(73, 168, 8));
    inputs.append(ergDataPoint(74, 171, 8));
    inputs.append(ergDataPoint(72, 164, 8));
    inputs.append(ergDataPoint(70, 157, 8));
    inputs.append(ergDataPoint(69, 153, 8));
    inputs.append(ergDataPoint(76, 179, 8));
    inputs.append(ergDataPoint(86, 212, 8));
    inputs.append(ergDataPoint(90, 225, 8));
    inputs.append(ergDataPoint(93, 237, 8));
    inputs.append(ergDataPoint(96, 250, 8));
    inputs.append(ergDataPoint(107, 298, 8));
    inputs.append(ergDataPoint(115, 332, 8));
    inputs.append(ergDataPoint(118, 345, 8));
    inputs.append(ergDataPoint(119, 349, 8));
    inputs.append(ergDataPoint(116, 336, 8));
    inputs.append(ergDataPoint(102, 276, 8));
    inputs.append(ergDataPoint(85, 209, 8));
    inputs.append(ergDataPoint(82, 200, 8));
    inputs.append(ergDataPoint(80, 194, 8));
    inputs.append(ergDataPoint(75, 175, 8));
    inputs.append(ergDataPoint(71, 160, 8));
    inputs.append(ergDataPoint(66, 141, 8));
    inputs.append(ergDataPoint(62, 125, 8));
    inputs.append(ergDataPoint(56, 105, 8));
    inputs.append(ergDataPoint(46, 75, 8));
    inputs.append(ergDataPoint(46, 82, 9));
    inputs.append(ergDataPoint(48, 89, 9));
    inputs.append(ergDataPoint(49, 92, 9));
    inputs.append(ergDataPoint(50, 96, 9));
    inputs.append(ergDataPoint(52, 101, 9));
    inputs.append(ergDataPoint(56, 113, 9));
    inputs.append(ergDataPoint(60, 125, 9));
    inputs.append(ergDataPoint(64, 142, 9));
    inputs.append(ergDataPoint(67, 155, 9));
    inputs.append(ergDataPoint(70, 169, 9));
    inputs.append(ergDataPoint(71, 173, 9));
    inputs.append(ergDataPoint(73, 182, 9));
    inputs.append(ergDataPoint(75, 191, 9));
    inputs.append(ergDataPoint(77, 199, 9));
    inputs.append(ergDataPoint(78, 204, 9));
    inputs.append(ergDataPoint(82, 219, 9));
    inputs.append(ergDataPoint(84, 225, 9));
    inputs.append(ergDataPoint(89, 240, 9));
    inputs.append(ergDataPoint(95, 265, 9));
    inputs.append(ergDataPoint(97, 274, 9));
    inputs.append(ergDataPoint(101, 292, 9));
    inputs.append(ergDataPoint(103, 301, 9));
    inputs.append(ergDataPoint(106, 315, 9));
    inputs.append(ergDataPoint(109, 328, 9));
    inputs.append(ergDataPoint(112, 342, 9));
    inputs.append(ergDataPoint(116, 360, 9));
    inputs.append(ergDataPoint(117, 364, 9));
    inputs.append(ergDataPoint(118, 369, 9));
    inputs.append(ergDataPoint(108, 324, 9));
    inputs.append(ergDataPoint(88, 237, 9));
    inputs.append(ergDataPoint(83, 222, 9));
    inputs.append(ergDataPoint(58, 119, 9));
    inputs.append(ergDataPoint(53, 104, 9));
    inputs.append(ergDataPoint(49, 92, 10));
    inputs.append(ergDataPoint(46, 86, 10));
    inputs.append(ergDataPoint(44, 78, 10));
    inputs.append(ergDataPoint(52, 107, 10));
    inputs.append(ergDataPoint(58, 125, 10));
    inputs.append(ergDataPoint(66, 159, 10));
    inputs.append(ergDataPoint(68, 168, 10));
    inputs.append(ergDataPoint(69, 172, 10));
    inputs.append(ergDataPoint(70, 177, 10));
    inputs.append(ergDataPoint(71, 181, 10));
    inputs.append(ergDataPoint(73, 190, 10));
    inputs.append(ergDataPoint(75, 200, 10));
    inputs.append(ergDataPoint(76, 204, 10));
    inputs.append(ergDataPoint(80, 223, 10));
    inputs.append(ergDataPoint(81, 226, 10));
    inputs.append(ergDataPoint(84, 235, 10));
    inputs.append(ergDataPoint(91, 257, 10));
    inputs.append(ergDataPoint(98, 292, 10));
    inputs.append(ergDataPoint(101, 306, 10));
    inputs.append(ergDataPoint(103, 316, 10));
    inputs.append(ergDataPoint(104, 321, 10));
    inputs.append(ergDataPoint(106, 331, 10));
    inputs.append(ergDataPoint(112, 360, 10));
    inputs.append(ergDataPoint(118, 390, 10));
    inputs.append(ergDataPoint(114, 370, 10));
    inputs.append(ergDataPoint(96, 282, 10));
    inputs.append(ergDataPoint(90, 253, 10));
    inputs.append(ergDataPoint(82, 229, 10));
    inputs.append(ergDataPoint(79, 218, 10));
    inputs.append(ergDataPoint(72, 186, 10));
    inputs.append(ergDataPoint(63, 145, 10));
    inputs.append(ergDataPoint(63, 155, 11));
    inputs.append(ergDataPoint(62, 150, 11));
    inputs.append(ergDataPoint(57, 130, 11));
    inputs.append(ergDataPoint(61, 145, 11));
    inputs.append(ergDataPoint(65, 165, 11));
    inputs.append(ergDataPoint(66, 170, 11));
    inputs.append(ergDataPoint(69, 185, 11));
    inputs.append(ergDataPoint(71, 195, 11));
    inputs.append(ergDataPoint(72, 200, 11));
    inputs.append(ergDataPoint(73, 205, 11));
    inputs.append(ergDataPoint(74, 210, 11));
    inputs.append(ergDataPoint(75, 216, 11));
    inputs.append(ergDataPoint(77, 226, 11));
    inputs.append(ergDataPoint(79, 236, 11));
    inputs.append(ergDataPoint(81, 245, 11));
    inputs.append(ergDataPoint(83, 252, 11));
    inputs.append(ergDataPoint(84, 255, 11));
    inputs.append(ergDataPoint(85, 259, 11));
    inputs.append(ergDataPoint(86, 262, 11));
    inputs.append(ergDataPoint(88, 269, 11));
    inputs.append(ergDataPoint(90, 276, 11));
    inputs.append(ergDataPoint(93, 290, 11));
    inputs.append(ergDataPoint(98, 315, 11));
    inputs.append(ergDataPoint(103, 339, 11));
    inputs.append(ergDataPoint(108, 364, 11));
    inputs.append(ergDataPoint(111, 378, 11));
    inputs.append(ergDataPoint(112, 383, 11));
    inputs.append(ergDataPoint(114, 393, 11));
    inputs.append(ergDataPoint(104, 344, 11));
    inputs.append(ergDataPoint(59, 136, 11));
    inputs.append(ergDataPoint(60, 140, 12));
    inputs.append(ergDataPoint(59, 143, 12));
    inputs.append(ergDataPoint(69, 193, 12));
    inputs.append(ergDataPoint(71, 204, 12));
    inputs.append(ergDataPoint(72, 210, 12));
    inputs.append(ergDataPoint(74, 221, 12));
    inputs.append(ergDataPoint(73, 215, 12));
    inputs.append(ergDataPoint(80, 255, 12));
    inputs.append(ergDataPoint(81, 258, 12));
    inputs.append(ergDataPoint(82, 261, 12));
    inputs.append(ergDataPoint(84, 267, 12));
    inputs.append(ergDataPoint(88, 280, 12));
    inputs.append(ergDataPoint(89, 283, 12));
    inputs.append(ergDataPoint(96, 318, 12));
    inputs.append(ergDataPoint(104, 359, 12));
    inputs.append(ergDataPoint(108, 380, 12));
    inputs.append(ergDataPoint(111, 396, 12));
    inputs.append(ergDataPoint(114, 411, 12));
    inputs.append(ergDataPoint(119, 437, 12));
    inputs.append(ergDataPoint(123, 458, 12));
    inputs.append(ergDataPoint(128, 484, 12));
    inputs.append(ergDataPoint(126, 474, 12));
    inputs.append(ergDataPoint(118, 432, 12));
    inputs.append(ergDataPoint(110, 391, 12));
    inputs.append(ergDataPoint(103, 354, 12));
    inputs.append(ergDataPoint(102, 349, 12));
    inputs.append(ergDataPoint(98, 328, 12));
    inputs.append(ergDataPoint(91, 292, 12));
    inputs.append(ergDataPoint(85, 271, 12));
    inputs.append(ergDataPoint(83, 264, 12));
    inputs.append(ergDataPoint(78, 243, 12));
    inputs.append(ergDataPoint(76, 232, 12));
    inputs.append(ergDataPoint(75, 227, 12));
    inputs.append(ergDataPoint(70, 199, 12));
    inputs.append(ergDataPoint(67, 183, 12));
    inputs.append(ergDataPoint(63, 162, 12));
    inputs.append(ergDataPoint(58, 148, 13));
    inputs.append(ergDataPoint(57, 145, 13));
    inputs.append(ergDataPoint(59, 151, 13));
    inputs.append(ergDataPoint(61, 160, 13));
    inputs.append(ergDataPoint(63, 172, 13));
    inputs.append(ergDataPoint(66, 189, 13));
    inputs.append(ergDataPoint(68, 201, 13));
    inputs.append(ergDataPoint(69, 207, 13));
    inputs.append(ergDataPoint(71, 218, 13));
    inputs.append(ergDataPoint(73, 230, 13));
    inputs.append(ergDataPoint(75, 242, 13));
    inputs.append(ergDataPoint(76, 248, 13));
    inputs.append(ergDataPoint(77, 254, 13));
    inputs.append(ergDataPoint(78, 260, 13));
    inputs.append(ergDataPoint(79, 266, 13));
    inputs.append(ergDataPoint(80, 272, 13));
    inputs.append(ergDataPoint(82, 278, 13));
    inputs.append(ergDataPoint(83, 281, 13));
    inputs.append(ergDataPoint(85, 288, 13));
    inputs.append(ergDataPoint(88, 298, 13));
    inputs.append(ergDataPoint(90, 305, 13));
    inputs.append(ergDataPoint(96, 336, 13));
    inputs.append(ergDataPoint(98, 346, 13));
    inputs.append(ergDataPoint(97, 341, 13));
    inputs.append(ergDataPoint(99, 351, 13));
    inputs.append(ergDataPoint(100, 357, 13));
    inputs.append(ergDataPoint(111, 414, 13));
    inputs.append(ergDataPoint(118, 450, 13));
    inputs.append(ergDataPoint(121, 466, 13));
    inputs.append(ergDataPoint(125, 487, 13));
    inputs.append(ergDataPoint(107, 393, 13));
    inputs.append(ergDataPoint(101, 362, 13));
    inputs.append(ergDataPoint(93, 320, 13));
    inputs.append(ergDataPoint(92, 315, 13));
    inputs.append(ergDataPoint(86, 291, 13));
    inputs.append(ergDataPoint(72, 224, 13));
    inputs.append(ergDataPoint(64, 178, 13));
    inputs.append(ergDataPoint(56, 148, 14));
    inputs.append(ergDataPoint(55, 144, 14));
    inputs.append(ergDataPoint(58, 155, 14));
    inputs.append(ergDataPoint(59, 158, 14));
    inputs.append(ergDataPoint(57, 151, 14));
    inputs.append(ergDataPoint(60, 162, 14));
    inputs.append(ergDataPoint(62, 173, 14));
    inputs.append(ergDataPoint(64, 185, 14));
    inputs.append(ergDataPoint(67, 202, 14));
    inputs.append(ergDataPoint(66, 196, 14));
    inputs.append(ergDataPoint(68, 208, 14));
    inputs.append(ergDataPoint(69, 214, 14));
    inputs.append(ergDataPoint(71, 226, 14));
    inputs.append(ergDataPoint(72, 232, 14));
    inputs.append(ergDataPoint(74, 244, 14));
    inputs.append(ergDataPoint(75, 250, 14));
    inputs.append(ergDataPoint(79, 274, 14));
    inputs.append(ergDataPoint(80, 280, 14));
    inputs.append(ergDataPoint(84, 294, 14));
    inputs.append(ergDataPoint(85, 297, 14));
    inputs.append(ergDataPoint(86, 301, 14));
    inputs.append(ergDataPoint(90, 315, 14));
    inputs.append(ergDataPoint(92, 325, 14));
    inputs.append(ergDataPoint(95, 341, 14));
    inputs.append(ergDataPoint(98, 356, 14));
    inputs.append(ergDataPoint(102, 377, 14));
    inputs.append(ergDataPoint(104, 387, 14));
    inputs.append(ergDataPoint(108, 408, 14));
    inputs.append(ergDataPoint(113, 434, 14));
    inputs.append(ergDataPoint(118, 460, 14));
    inputs.append(ergDataPoint(126, 502, 14));
    inputs.append(ergDataPoint(127, 507, 14));
    inputs.append(ergDataPoint(132, 533, 14));
    inputs.append(ergDataPoint(130, 523, 14));
    inputs.append(ergDataPoint(117, 455, 14));
    inputs.append(ergDataPoint(99, 361, 14));
    inputs.append(ergDataPoint(97, 351, 14));
    inputs.append(ergDataPoint(91, 320, 14));
    inputs.append(ergDataPoint(88, 308, 14));
    inputs.append(ergDataPoint(83, 290, 14));
    inputs.append(ergDataPoint(82, 287, 14));
    inputs.append(ergDataPoint(81, 283, 14));
    inputs.append(ergDataPoint(78, 268, 14));
    inputs.append(ergDataPoint(76, 256, 14));
    inputs.append(ergDataPoint(73, 238, 14));
    inputs.append(ergDataPoint(61, 176, 15));
    inputs.append(ergDataPoint(62, 182, 15));
    inputs.append(ergDataPoint(64, 194, 15));
    inputs.append(ergDataPoint(63, 188, 15));
    inputs.append(ergDataPoint(67, 213, 15));
    inputs.append(ergDataPoint(71, 238, 15));
    inputs.append(ergDataPoint(74, 259, 15));
    inputs.append(ergDataPoint(79, 293, 15));
    inputs.append(ergDataPoint(80, 300, 15));
    inputs.append(ergDataPoint(82, 306, 15));
    inputs.append(ergDataPoint(84, 313, 15));
    inputs.append(ergDataPoint(85, 317, 15));
    inputs.append(ergDataPoint(88, 327, 15));
    inputs.append(ergDataPoint(91, 339, 15));
    inputs.append(ergDataPoint(92, 345, 15));
    inputs.append(ergDataPoint(99, 384, 15));
    inputs.append(ergDataPoint(101, 395, 15));
    inputs.append(ergDataPoint(98, 378, 15));
    inputs.append(ergDataPoint(100, 390, 15));
    inputs.append(ergDataPoint(102, 401, 15));
    inputs.append(ergDataPoint(113, 462, 15));
    inputs.append(ergDataPoint(122, 513, 15));
    inputs.append(ergDataPoint(123, 518, 15));
    inputs.append(ergDataPoint(108, 434, 15));
    inputs.append(ergDataPoint(83, 310, 15));
    inputs.append(ergDataPoint(78, 286, 15));
    inputs.append(ergDataPoint(76, 272, 15));
    inputs.append(ergDataPoint(70, 232, 15));
    inputs.append(ergDataPoint(69, 225, 15));
    inputs.append(ergDataPoint(68, 219, 15));
    inputs.append(ergDataPoint(66, 207, 15));
    inputs.append(ergDataPoint(60, 177, 16));
    inputs.append(ergDataPoint(62, 191, 16));
    inputs.append(ergDataPoint(66, 219, 16));
    inputs.append(ergDataPoint(69, 240, 16));
    inputs.append(ergDataPoint(61, 184, 16));
    inputs.append(ergDataPoint(59, 174, 16));
    inputs.append(ergDataPoint(64, 205, 16));
    inputs.append(ergDataPoint(68, 233, 16));
    inputs.append(ergDataPoint(72, 262, 16));
    inputs.append(ergDataPoint(74, 277, 16));
    inputs.append(ergDataPoint(76, 292, 16));
    inputs.append(ergDataPoint(78, 307, 16));
    inputs.append(ergDataPoint(83, 331, 16));
    inputs.append(ergDataPoint(85, 337, 16));
    inputs.append(ergDataPoint(88, 346, 16));
    inputs.append(ergDataPoint(89, 349, 16));
    inputs.append(ergDataPoint(90, 353, 16));
    inputs.append(ergDataPoint(93, 371, 16));
    inputs.append(ergDataPoint(102, 425, 16));
    inputs.append(ergDataPoint(112, 485, 16));
    inputs.append(ergDataPoint(117, 515, 16));
    inputs.append(ergDataPoint(118, 521, 16));
    inputs.append(ergDataPoint(111, 479, 16));
    inputs.append(ergDataPoint(94, 377, 16));
    inputs.append(ergDataPoint(86, 340, 16));
    inputs.append(ergDataPoint(82, 328, 16));
    inputs.append(ergDataPoint(77, 299, 16));
    inputs.append(ergDataPoint(65, 212, 16));
    inputs.append(ergDataPoint(58, 171, 16));
    inputs.append(ergDataPoint(56, 165, 16));
    inputs.append(ergDataPoint(52, 158, 17));
    inputs.append(ergDataPoint(50, 152, 17));
    inputs.append(ergDataPoint(51, 155, 17));
    inputs.append(ergDataPoint(54, 165, 17));
    inputs.append(ergDataPoint(53, 161, 17));
    inputs.append(ergDataPoint(56, 171, 17));
    inputs.append(ergDataPoint(62, 199, 17));
    inputs.append(ergDataPoint(66, 228, 17));
    inputs.append(ergDataPoint(67, 235, 17));
    inputs.append(ergDataPoint(69, 249, 17));
    inputs.append(ergDataPoint(71, 264, 17));
    inputs.append(ergDataPoint(72, 272, 17));
    inputs.append(ergDataPoint(73, 280, 17));
    inputs.append(ergDataPoint(74, 288, 17));
    inputs.append(ergDataPoint(75, 296, 17));
    inputs.append(ergDataPoint(76, 303, 17));
    inputs.append(ergDataPoint(82, 341, 17));
    inputs.append(ergDataPoint(84, 347, 17));
    inputs.append(ergDataPoint(88, 359, 17));
    inputs.append(ergDataPoint(90, 365, 17));
    inputs.append(ergDataPoint(95, 395, 17));
    inputs.append(ergDataPoint(100, 425, 17));
    inputs.append(ergDataPoint(102, 437, 17));
    inputs.append(ergDataPoint(111, 491, 17));
    inputs.append(ergDataPoint(116, 521, 17));
    inputs.append(ergDataPoint(117, 527, 17));
    inputs.append(ergDataPoint(110, 485, 17));
    inputs.append(ergDataPoint(92, 377, 17));
    inputs.append(ergDataPoint(86, 353, 17));
    inputs.append(ergDataPoint(83, 344, 17));
    inputs.append(ergDataPoint(80, 335, 17));
    inputs.append(ergDataPoint(79, 327, 17));
    inputs.append(ergDataPoint(78, 319, 17));
    inputs.append(ergDataPoint(64, 213, 17));
    inputs.append(ergDataPoint(63, 206, 17));
    inputs.append(ergDataPoint(61, 192, 17));
    inputs.append(ergDataPoint(57, 175, 17));
    inputs.append(ergDataPoint(52, 164, 18));
    inputs.append(ergDataPoint(51, 160, 18));
    inputs.append(ergDataPoint(53, 167, 18));
    inputs.append(ergDataPoint(49, 151, 18));
    inputs.append(ergDataPoint(54, 171, 18));
    inputs.append(ergDataPoint(55, 174, 18));
    inputs.append(ergDataPoint(57, 181, 18));
    inputs.append(ergDataPoint(59, 188, 18));
    inputs.append(ergDataPoint(61, 199, 18));
    inputs.append(ergDataPoint(64, 221, 18));
    inputs.append(ergDataPoint(66, 236, 18));
    inputs.append(ergDataPoint(70, 266, 18));
    inputs.append(ergDataPoint(76, 314, 18));
    inputs.append(ergDataPoint(78, 330, 18));
    inputs.append(ergDataPoint(79, 338, 18));
    inputs.append(ergDataPoint(82, 352, 18));
    inputs.append(ergDataPoint(86, 364, 18));
    inputs.append(ergDataPoint(88, 370, 18));
    inputs.append(ergDataPoint(92, 388, 18));
    inputs.append(ergDataPoint(95, 407, 18));
    inputs.append(ergDataPoint(96, 413, 18));
    inputs.append(ergDataPoint(101, 445, 18));
    inputs.append(ergDataPoint(119, 558, 18));
    inputs.append(ergDataPoint(127, 609, 18));
    inputs.append(ergDataPoint(121, 571, 18));
    inputs.append(ergDataPoint(104, 464, 18));
    inputs.append(ergDataPoint(97, 420, 18));
    inputs.append(ergDataPoint(90, 376, 18));
    inputs.append(ergDataPoint(87, 367, 18));
    inputs.append(ergDataPoint(84, 358, 18));
    inputs.append(ergDataPoint(80, 347, 18));
    inputs.append(ergDataPoint(75, 306, 18));
    inputs.append(ergDataPoint(74, 298, 18));
    inputs.append(ergDataPoint(65, 229, 18));
    inputs.append(ergDataPoint(63, 214, 18));
    inputs.append(ergDataPoint(62, 206, 18));
    inputs.append(ergDataPoint(60, 192, 18));
    inputs.append(ergDataPoint(58, 185, 18));
    inputs.append(ergDataPoint(51, 164, 19));
    inputs.append(ergDataPoint(48, 149, 19));
    inputs.append(ergDataPoint(49, 155, 19));
    inputs.append(ergDataPoint(52, 168, 19));
    inputs.append(ergDataPoint(50, 161, 19));
    inputs.append(ergDataPoint(55, 180, 19));
    inputs.append(ergDataPoint(58, 192, 19));
    inputs.append(ergDataPoint(61, 207, 19));
    inputs.append(ergDataPoint(63, 221, 19));
    inputs.append(ergDataPoint(64, 229, 19));
    inputs.append(ergDataPoint(66, 243, 19));
    inputs.append(ergDataPoint(75, 315, 19));
    inputs.append(ergDataPoint(81, 360, 19));
    inputs.append(ergDataPoint(84, 369, 19));
    inputs.append(ergDataPoint(86, 375, 19));
    inputs.append(ergDataPoint(95, 418, 19));
    inputs.append(ergDataPoint(104, 473, 19));
    inputs.append(ergDataPoint(112, 523, 19));
    inputs.append(ergDataPoint(113, 529, 19));
    inputs.append(ergDataPoint(111, 517, 19));
    inputs.append(ergDataPoint(79, 349, 19));
    inputs.append(ergDataPoint(76, 324, 19));
    inputs.append(ergDataPoint(73, 298, 19));
    inputs.append(ergDataPoint(71, 281, 19));
    inputs.append(ergDataPoint(69, 265, 19));
    inputs.append(ergDataPoint(62, 214, 19));
    inputs.append(ergDataPoint(60, 200, 19));
    inputs.append(ergDataPoint(56, 184, 19));
    inputs.append(ergDataPoint(47, 143, 19));
    inputs.append(ergDataPoint(47, 148, 20));
    inputs.append(ergDataPoint(48, 154, 20));
    inputs.append(ergDataPoint(51, 170, 20));
    inputs.append(ergDataPoint(49, 160, 20));
    inputs.append(ergDataPoint(46, 142, 20));
    inputs.append(ergDataPoint(53, 178, 20));
    inputs.append(ergDataPoint(56, 190, 20));
    inputs.append(ergDataPoint(60, 207, 20));
    inputs.append(ergDataPoint(64, 235, 20));
    inputs.append(ergDataPoint(70, 279, 20));
    inputs.append(ergDataPoint(71, 287, 20));
    inputs.append(ergDataPoint(78, 350, 20));
    inputs.append(ergDataPoint(82, 373, 20));
    inputs.append(ergDataPoint(86, 383, 20));
    inputs.append(ergDataPoint(97, 441, 20));
    inputs.append(ergDataPoint(100, 462, 20));
    inputs.append(ergDataPoint(99, 455, 20));
    inputs.append(ergDataPoint(95, 428, 20));
    inputs.append(ergDataPoint(92, 407, 20));
    inputs.append(ergDataPoint(83, 375, 20));
    inputs.append(ergDataPoint(68, 264, 20));
    inputs.append(ergDataPoint(72, 296, 20));
    inputs.append(ergDataPoint(69, 271, 20));
    inputs.append(ergDataPoint(52, 174, 20));
    inputs.append(ergDataPoint(35, 84, 20));
    inputs.append(ergDataPoint(31, 66, 20));
    inputs.append(ergDataPoint(34, 80, 20));
    inputs.append(ergDataPoint(37, 93, 20));
    inputs.append(ergDataPoint(36, 89, 20));
    inputs.append(ergDataPoint(45, 136, 20));
    inputs.append(ergDataPoint(62, 221, 20));
    inputs.append(ergDataPoint(66, 250, 20));
    inputs.append(ergDataPoint(67, 257, 20));
    inputs.append(ergDataPoint(73, 305, 20));
    inputs.append(ergDataPoint(76, 332, 20));
    inputs.append(ergDataPoint(87, 386, 20));
    inputs.append(ergDataPoint(44, 130, 20));
    inputs.append(ergDataPoint(41, 112, 20));
    inputs.append(ergDataPoint(40, 107, 20));
    inputs.append(ergDataPoint(42, 118, 20));
    inputs.append(ergDataPoint(38, 98, 20));


    // test that the input points are mapped directly
    expected.append(inputs);

    this->test_wattageEstimation(inputs, expected);

    // Now try some interpolated points
    expected.clear();

    expected.append(ergDataPoint(71, 126, 4)); 
    expected.append(ergDataPoint(71, 287, 20)); 
    expected.append(ergDataPoint(72, 296, 20)); 
    expected.append(ergDataPoint(73, 305, 20)); 
    expected.append(ergDataPoint(74, 314, 20)); 
    expected.append(ergDataPoint(75, 323, 20));
    expected.append(ergDataPoint(76, 332, 20)); 
    expected.append(ergDataPoint(77, 341, 20)); 
    expected.append(ergDataPoint(78, 350, 20));
    expected.append(ergDataPoint(79, 355, 20));
    this->test_wattageEstimation(inputs, expected);

}
